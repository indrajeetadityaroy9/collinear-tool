set -o errexit
set -o pipefail
set -o nounset

redis_ready() {
    redis-cli -h redis -p 6379 ping | grep PONG
}

echo "Waiting for Redis to be ready..."
until redis_ready; do
  >&2 echo 'Redis is unavailable - sleeping'
  sleep 1
done
>&2 echo 'Redis is up - continuing...'

if [ "$#" -gt 0 ] && [ -f "$1" ]; then
    exec bash "$@"
else
    exec "$@"
fi
